<UserControl x:Class="factory_automation_system_FAS_.Views.MapView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:b="clr-namespace:factory_automation_system_FAS_.Behaviors"
             Background="Transparent">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- main_layout.png는 전체 mockup이라, 상단 "맵 영역"만 Crop해서 사용 -->
        <BitmapImage x:Key="MainLayoutBmp"
                     UriSource="/Assets/Maps/main_layout.png"
                     CacheOption="OnLoad" />

        <!-- Crop: (x=0, y=150, w=3100, h=1700) -->
        <CroppedBitmap x:Key="MapBg"
                       Source="{StaticResource MainLayoutBmp}"
                       SourceRect="0,150,3100,1700" />
    </UserControl.Resources>

    <Border Background="{DynamicResource Card}"
            BorderBrush="{DynamicResource BorderSoft}"
            BorderThickness="1"
            CornerRadius="16"
            Padding="10">

        <Grid>
            <!-- Canvas는 Crop된 영역 크기와 동일하게 -->
            <Canvas x:Name="MapCanvas"
                    Width="3100" Height="1700"
                    RenderTransform="{Binding Viewport.Transform}"
                    b:MapInputBehavior.TargetCanvas="{Binding ElementName=MapCanvas}"
                    b:MapInputBehavior.PanCommand="{Binding PanCommand}"
                    b:MapInputBehavior.ZoomCommand="{Binding ZoomCommand}"
                    Background="Transparent">

                <!-- Background -->
                <Image Canvas.Left="0" Canvas.Top="0"
                       Width="3100" Height="1700"
                       Source="{StaticResource MapBg}"
                       Stretch="Fill" />

                <!-- RC카 (사각형/원은 취향대로 바꾸면 됨) -->
                <Border Width="70" Height="70"
                        CornerRadius="16"
                        Background="#2EE6A6"
                        BorderBrush="#0F2E25"
                        BorderThickness="2"
                        Canvas.Left="{Binding CartX}"
                        Canvas.Top="{Binding CartY}">
                    <TextBlock Text="RC"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               FontWeight="Bold"
                               Foreground="#0B0F14"/>
                </Border>

                <!-- 카트 적재 제품 (빨간 점) -->
                <Ellipse Width="18" Height="18"
                         Fill="#FF4D4D"
                         Stroke="#7A1E1E"
                         StrokeThickness="2"
                         Canvas.Left="{Binding CartLoadX}"
                         Canvas.Top="{Binding CartLoadY}"
                         Visibility="{Binding CartHasLoad, Converter={StaticResource BoolToVis}}"/>

            </Canvas>
        </Grid>
    </Border>
</UserControl>
