<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:me="clr-namespace:factory_automation_system_FAS_.ViewModels.MapEntities"
                    xmlns:b="clr-namespace:factory_automation_system_FAS_.Behaviors">


    <BooleanToVisibilityConverter x:Key="BoolToVis"/>

    <!-- =========================
         Conveyor: 바디 + 중앙 라인 + 화살표 + Rotation
         ========================= -->
    <DataTemplate DataType="{x:Type me:ConveyorVM}">
        <Button Background="Transparent"
                BorderThickness="0"
                Padding="0"
                Focusable="False"
                Cursor="Hand"
                Command="{Binding DataContext.SelectEntityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}">
            <Grid Width="{Binding Width}" Height="{Binding Height}"
                  RenderTransformOrigin="0.5,0.5"
                  ToolTip="{Binding TooltipText}">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.6" ScaleY="1.6"/>
                        <RotateTransform Angle="{Binding Rotation}"/>
                    </TransformGroup>
                </Grid.RenderTransform>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>

                <Border CornerRadius="3" BorderThickness="1">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Background" Value="{DynamicResource MapOverlayFill}" />
                            <Setter Property="BorderBrush" Value="{DynamicResource MapOverlayStrokeSoft}" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Running}">
                                    <Setter Property="BorderBrush" Value="{DynamicResource MapOverlayAccent}" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Fault}">
                                    <Setter Property="BorderBrush" Value="{DynamicResource MapOverlayFault}" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Offline}">
                                    <Setter Property="Opacity" Value="0.35" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>

                <Rectangle Height="2"
                           HorizontalAlignment="Stretch"
                           VerticalAlignment="Center"
                           Margin="6,0,6,0"
                           Fill="{DynamicResource MapOverlayStrokeSoft}"
                           Opacity="0.55"/>

                <Path Data="M 0 0 L 10 6 L 0 12 Z"
                      Width="10" Height="12"
                      HorizontalAlignment="Right"
                      VerticalAlignment="Center"
                      Margin="0,0,6,0"
                      Fill="{DynamicResource MapOverlayStrokeSoft}"
                      Opacity="0.75"/>
            </Grid>
        </Button>
    </DataTemplate>

    <!-- =========================
         Layout Zone (배경영역)
         ========================= -->
    <DataTemplate DataType="{x:Type me:LayoutZoneVM}">
        <Border Width="{Binding Width}"
                Height="{Binding Height}"
                Background="{Binding Fill}"
                BorderBrush="{Binding Stroke}"
                BorderThickness="{Binding StrokeThickness}"
                CornerRadius="{Binding CornerRadius}"
                IsHitTestVisible="{Binding IsInteractive}">
            <Grid>

                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>
                <TextBlock Text="{Binding DisplayName}"
                           FontSize="{Binding LabelFontSize}"
                           FontWeight="Bold"
                           Foreground="#22323E"
                           Opacity="0.6"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </DataTemplate>

    <!-- =========================
         Conveyor Block (레이아웃용)
         ========================= -->
    <DataTemplate DataType="{x:Type me:ConveyorBlockVM}">
        <Grid RenderTransformOrigin="0.5,0.5" Width="{Binding Width}"
              Height="{Binding Height}"
              IsHitTestVisible="{Binding IsInteractive}">
            <Grid.RenderTransform>
                <ScaleTransform ScaleX="1.6" ScaleY="1.6"/>
            </Grid.RenderTransform>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>


            <Border Background="{Binding Fill}"
                    BorderBrush="{Binding Stroke}"
                    BorderThickness="{Binding StrokeThickness}"
                    CornerRadius="10"/>

            <Rectangle Height="3"
                       RadiusX="2" RadiusY="2"
                       Fill="#7A8896"
                       Opacity="0.35"
                       VerticalAlignment="Center"
                       Visibility="{Binding ShowCenterLine, Converter={StaticResource BoolToVis}}"/>

            <TextBlock Text="{Binding DisplayName}"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Foreground="#22323E"
                       Opacity="0.55"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"/>
        </Grid>
    </DataTemplate>

    <!-- =========================
         Path (Polyline)
         ========================= -->
    <DataTemplate DataType="{x:Type me:PathVM}">
        <Polyline Points="{Binding Points}"
                  Stroke="#2EE6A6"
                  StrokeThickness="{Binding Thickness}"
                  StrokeLineJoin="Round"
                  StrokeStartLineCap="Round"
                  StrokeEndLineCap="Round"
                  Opacity="0.35"
                  IsHitTestVisible="{Binding IsInteractive}"/>
    </DataTemplate>

    <!-- =========================
         Sensor: 링 + 점 (Triggered면 Accent)
         ========================= -->
    <DataTemplate DataType="{x:Type me:SensorVM}">
        <Button Background="Transparent"
                BorderThickness="0"
                Padding="0"
                Focusable="False"
                Cursor="Hand"
                Command="{Binding DataContext.SelectEntityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}">

            <Grid Width="{Binding Width}" Height="{Binding Height}"
                  RenderTransformOrigin="0.5,0.5"
                  ToolTip="{Binding TooltipText}">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.6" ScaleY="1.6"/>
                        <RotateTransform Angle="{Binding Rotation}"/>
                    </TransformGroup>
                </Grid.RenderTransform>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>

                <Ellipse Stroke="{DynamicResource MapOverlayStrokeSoft}"
                         StrokeThickness="2"
                         Fill="Transparent"
                         Opacity="0.9"/>

                <Ellipse Width="6" Height="6"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center">
                    <Ellipse.Style>
                        <Style TargetType="Ellipse">
                            <Setter Property="Fill" Value="{DynamicResource MapOverlayStrokeSoft}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsTriggered}" Value="True">
                                    <Setter Property="Fill" Value="{DynamicResource MapOverlayAccent}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Fault}">
                                    <Setter Property="Fill" Value="{DynamicResource MapOverlayFault}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Offline}">
                                    <Setter Property="Opacity" Value="0.25"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>
            </Grid>
        </Button>
    </DataTemplate>

    <!-- =========================
         Camera: 마름모(◇)
         ========================= -->
    <DataTemplate DataType="{x:Type me:CameraVM}">
        <Button Background="Transparent"
                BorderThickness="0"
                Padding="0"
                Focusable="False"
                Cursor="Hand"
                Command="{Binding DataContext.SelectEntityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}">
            <Grid Width="{Binding Width}" Height="{Binding Height}"
                  RenderTransformOrigin="0.5,0.5"
                  ToolTip="{Binding TooltipText}">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.6" ScaleY="1.6"/>
                        <RotateTransform Angle="{Binding Rotation}"/>
                    </TransformGroup>
                </Grid.RenderTransform>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>

                <Polygon Points="0.5,0  1,0.5  0.5,1  0,0.5"
                         Stretch="Fill"
                         StrokeThickness="1">
                    <Polygon.Style>
                        <Style TargetType="Polygon">
                            <Setter Property="Fill" Value="{DynamicResource MapOverlayFill}"/>
                            <Setter Property="Stroke" Value="{DynamicResource MapOverlayStrokeSoft}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                    <Setter Property="Stroke" Value="{DynamicResource MapOverlayAccent}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Fault}">
                                    <Setter Property="Stroke" Value="{DynamicResource MapOverlayFault}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Offline}">
                                    <Setter Property="Opacity" Value="0.25"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Polygon.Style>
                </Polygon>

                <Ellipse Width="4" Height="4"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         Fill="{DynamicResource MapOverlayStrokeSoft}"
                         Opacity="0.85"/>
            </Grid>
        </Button>
    </DataTemplate>

    <!-- =========================
         Barcode: 평행사변형(기울어진 사각형)
         ========================= -->
    <DataTemplate DataType="{x:Type me:BarcodeScannerVM}">
        <Button Background="Transparent"
                BorderThickness="0"
                Padding="0"
                Focusable="False"
                Cursor="Hand"
                Command="{Binding DataContext.SelectEntityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}">
            <Grid Width="{Binding Width}" Height="{Binding Height}"
                  RenderTransformOrigin="0.5,0.5"
                  ToolTip="{Binding TooltipText}">
                <Grid.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.6" ScaleY="1.6"/>
                        <RotateTransform Angle="{Binding Rotation}"/>
                    </TransformGroup>
                </Grid.RenderTransform>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>

                <Grid RenderTransformOrigin="0.5,0.5">
                    <Grid.RenderTransform>
                        <SkewTransform AngleX="-20"/>
                    </Grid.RenderTransform>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>

                    <Border CornerRadius="2"
                            BorderThickness="1"
                            Background="{DynamicResource MapOverlayFill}"
                            BorderBrush="{DynamicResource MapOverlayStrokeSoft}">
                        <Grid Margin="4,3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="0.6*"/>
                                <ColumnDefinition Width="1.2*"/>
                                <ColumnDefinition Width="0.6*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>

                            <Rectangle Grid.Column="0" Fill="{DynamicResource MapOverlayStrokeSoft}" Opacity="0.75"/>
                            <Rectangle Grid.Column="1" Fill="{DynamicResource MapOverlayStrokeSoft}" Opacity="0.45"/>
                            <Rectangle Grid.Column="2" Fill="{DynamicResource MapOverlayStrokeSoft}" Opacity="0.85"/>
                            <Rectangle Grid.Column="3" Fill="{DynamicResource MapOverlayStrokeSoft}" Opacity="0.40"/>
                            <Rectangle Grid.Column="4" Fill="{DynamicResource MapOverlayStrokeSoft}" Opacity="0.70"/>
                        </Grid>
                    </Border>
                </Grid>

                <Ellipse Width="6" Height="6"
                         HorizontalAlignment="Right"
                         VerticalAlignment="Top"
                         Margin="0,2,2,0">
                    <Ellipse.Style>
                        <Style TargetType="Ellipse">
                            <Setter Property="Fill" Value="{DynamicResource MapOverlayStrokeSoft}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Fault}">
                                    <Setter Property="Fill" Value="{DynamicResource MapOverlayFault}"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Offline}">
                                    <Setter Property="Opacity" Value="0.25"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>
            </Grid>
        </Button>
    </DataTemplate>

    <!-- =========================
         fallback: DeviceVM (모르는 타입은 원형)
         ========================= -->
    <DataTemplate DataType="{x:Type me:DeviceVM}">
        <Button Background="Transparent"
                BorderThickness="0"
                Padding="0"
                Focusable="False"
                Cursor="Hand"
                Command="{Binding DataContext.SelectEntityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}">

            <Grid RenderTransformOrigin="0.5,0.5">
                <Grid.RenderTransform>
                    <ScaleTransform ScaleX="1.6" ScaleY="1.6"/>
                </Grid.RenderTransform>

            <Ellipse Width="{Binding Width}"
                     Height="{Binding Height}"
                     StrokeThickness="1"
                     ToolTip="{Binding TooltipText}">
                <Ellipse.Style>
                    <Style TargetType="Ellipse">
                        <Setter Property="Fill" Value="{DynamicResource MapOverlayFill}" />
                        <Setter Property="Stroke" Value="{DynamicResource MapOverlayStrokeSoft}" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Normal}">
                                <Setter Property="Stroke" Value="{DynamicResource MapOverlayAccent}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Offline}">
                                <Setter Property="Opacity" Value="0.25" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Status}" Value="{x:Static me:EntityStatus.Fault}">
                                <Setter Property="Stroke" Value="{DynamicResource MapOverlayFault}" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Ellipse.Style>
            </Ellipse>
                <Border Background="#CC000000" CornerRadius="6" Padding="6,2"
                        HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,-26,0,0" Panel.ZIndex="999">
                    <TextBlock Text="{Binding DisplayName}" Foreground="White" FontSize="12" FontWeight="SemiBold"/>
                </Border>

            </Grid>

        </Button>
    </DataTemplate>

</ResourceDictionary>
